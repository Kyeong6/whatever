# 업무내용

- 남은 업무 정리
- 통신 프로토콜에 맞게 수정 진행

## 9/2

### 남은 업무 파악

1. 이상치 값, 단계 재구성
2. 예측 관련 값들 정각(hr) + 1분에 보내기
3. 예외처리 구성
4. 로깅 구성
    - 동시성 부여한 작업들 주기 변경해서 테스트 진행을 위해서 로깅 남기는 것 필수!
5. Serial 통신 연결
6. 문서화 및 주석 작성

### 통신 프로토콜에 맞게 수정 진행

**변경사항**

- 기존에 통신 프로토콜에서 예측 진행 시간 또는 야간 최소 유량 시간이 아닐 경우 이상치 코드와 이상치 결과값을 “0”으로 나타냈는데, 이를 구분짓기 위해서 다음과 같이 수정했습니다.
    - 이상치 코드 : “5”
    - 이상치 결과값 : “N”
- 예측값 및 예측 이상치 진행 결과물은 13시 1분, 14시 1분과 같이 시(hr)가 정각이 되고 1분 후에 Serial 통신을 이용한 송신 기능 구현

## 9/4

### 문서화 및 주석 작성

- 스크립트 설명을 docs/usage.md 파일에 작성

<br/>

**문서화 진행하면서 파악한 확인사항**

1. LSTM 예측에 사용되는 data/output/criteria.csv을 도메인(유량 /수압력)이 공유해서 사용하는지 확인이 필요하다. 유량 → 수압력 순으로 예측이 수행되지만, criteria.csv를 공유해서 사용한다면 올바른 예측값이 아니기 때문이다
2. 예측값 이상치 같은 경우 다음과 같이 작성했다. 
기능 실행시간을 timestamp로 하였지만, 이게 아닌 해당 클래스인자에 timestamp를 설정하고, 해당 timestamp는 Serial 통신으로 제공받은 시간으로 설정하도록 변경 진행 필요

```python
# 기능 실행시간 사용
timestamp_minute = datetime.now().strftime('%Y-%m-%d %H:%M')
```

3. 서버 실행 후 1년이 지나면 실측값 저장 테이블인 REAL_VAL_TB의 값들을 삭제하는 로직 추가 필요
    - 추가로 현재 REAL_VAl_TB만 1년이 지날 경우 삭제인데, 다른 테이블도 삭제하는 로직 필요
4. 현재 lstm_processor.py의 LstmPredictionProcessor 클래스의 process_prediction 메서드가 예측값을 저장할 때 'JM1_p'로 열을 선택하는데 해당 방식이 아닌 인덱스로 수정 필요
5. 예측같은 경우 시(hr)가 정각이 될 때 수행되는데 서버 초기 실행일 경우 해당 데이터를 모두 반영하지 못하는 경우가 존재하기 때문에 처음에는 예측값을 주지 않는 방향으로 변경
6. 예측이 주기가 1시간인데 처음 실행 했을 때 정각(hr)에 실행되지 않는다면 주기가 의도와 달라지기 때문에 파악 필요
7. night_flow_value.py에서 이전 9분만 사용해서 평균을 내는 것이 아닌 해당 시간대 값도 저장하는 로직으로 변경

### 테스트 진행

- 기존 1년간의 텍스트 데이터를 이용해서 Serial 통신을 하는 것처럼 주기를 설정해서 이상치 검출 및 LSTM 예측이 잘 돌아가는 지 테스트 진행 필요
- 즉, Serial 통신 처럼 텍스트 파일 한 줄을 읽어서 이를 활용하여 로직을 수행